{% comment %}
  Travel Collection Summary Section
  Displays an intro/summary section with heading and body text
{% endcomment %}

{%- liquid
  assign summary_content = collection.metafields.travel.summary
  assign heading_part = section.settings.default_heading
  assign summary_html = ''
  assign has_custom_format = false

  # Check if metafield exists and has value
  if summary_content.value != blank
    # Render the metafield as HTML first
    assign summary_html = summary_content | metafield_tag

    # Check if using custom format with "Heading:" and "Summary:" markers
    if summary_html contains 'Heading:' and summary_html contains 'Summary:'
      assign has_custom_format = true

      # Extract heading (between "Heading:" and "Summary:")
      assign heading_split = summary_html | split: 'Heading:'
      assign after_heading = heading_split[1]
      assign parts = after_heading | split: 'Summary:'
      assign heading_text = parts[0] | strip_html | strip

      # Extract summary content (after "Summary:") - keep as HTML
      assign summary_html = parts[1]

      # Set the heading
      if heading_text != blank
        assign heading_part = heading_text
      endif
    endif
  endif

  # Determine if section should be shown
  assign show_section = false
  if has_custom_format and summary_html != blank
    assign show_section = true
  elsif summary_content.value != blank and has_custom_format == false
    assign show_section = true
  elsif section.settings.default_content != blank
    assign show_section = true
  endif
-%}

<style>
  .travel-summary {
    background-color: #E7E9EB;
    padding: 60px 20px;
  }

  .travel-summary__container {
    max-width: 1200px;
    margin: 0 auto;
  }

  .travel-summary__header {
    display: flex;
    align-items: center;
    margin-bottom: 24px;
  }

  .travel-summary__accent {
    width: 8px;
    height: 8px;
    background-color: #3E90C5;
    margin-right: 12px;
    flex-shrink: 0;
  }

  .travel-summary__heading {
    font-size: 14px;
    font-weight: 700;
    letter-spacing: 2px;
    text-transform: uppercase;
    color: #000000;
    margin: 0;
  }

  .travel-summary__content {
    font-size: 20px;
    line-height: 1.6;
    color: #000000;
    margin-bottom: 32px;
  }

  .travel-summary__content p {
    margin-bottom: 24px;
  }

  .travel-summary__content p:last-child {
    margin-bottom: 0;
  }

  .travel-summary__callout {
    background-color: #3E90C5;
    color: #FFFFFF;
    padding: 16px 24px;
    display: inline-block;
    font-size: 16px;
    font-weight: 500;
  }

  @media (max-width: 768px) {
    .travel-summary {
      padding: 40px 20px;
    }

    .travel-summary__content {
      font-size: 18px;
    }

    .travel-summary__callout {
      display: block;
      text-align: center;
    }
  }
</style>

{% if show_section %}
<section class="travel-summary">
  <div class="travel-summary__container">

    <!-- Debug info (remove in production) -->
    <script>
      console.log('=== TRAVEL SUMMARY DEBUG ===');
      console.log('Has custom format:', {{ has_custom_format | json }});
      console.log('Heading part:', {{ heading_part | json }});
      console.log('Summary part:', {{ summary_part | slice: 0, 100 | json }});
      console.log('Metafield type:', {{ summary_content.type | json }});
      console.log('Metafield exists:', {% if summary_content.value != blank %}true{% else %}false{% endif %});
    </script>

    <div class="travel-summary__header">
      <div class="travel-summary__accent"></div>
      <h2 class="travel-summary__heading">{{ heading_part }}</h2>
    </div>

    {% if has_custom_format and summary_html != blank %}
      <div class="travel-summary__content">
        {{ summary_html }}

        {% if section.settings.show_callout %}
          <div class="travel-summary__callout">
            {{ section.settings.callout_text }}
          </div>
        {% endif %}
      </div>
    {% elsif summary_content.value != blank %}
      <div class="travel-summary__content">
        {{ summary_content | metafield_tag }}

        {% if section.settings.show_callout %}
          <div class="travel-summary__callout">
            {{ section.settings.callout_text }}
          </div>
        {% endif %}
      </div>
    {% elsif section.settings.default_content != blank %}
      <div class="travel-summary__content">
        {{ section.settings.default_content }}

        {% if section.settings.show_callout %}
          <div class="travel-summary__callout">
            {{ section.settings.callout_text }}
          </div>
        {% endif %}
      </div>
    {% endif %}

  </div>
</section>
{% endif %}

{% schema %}
{
  "name": "Travel Summary",
  "class": "travel-collection-summary-section",
  "settings": [
    {
      "type": "header",
      "content": "Content"
    },
    {
      "type": "paragraph",
      "content": "Summary content is pulled from collection.metafields.travel.summary (rich text). Format: 'Heading: [content] Summary: [content]'"
    },
    {
      "type": "text",
      "id": "default_heading",
      "label": "Default heading",
      "default": "INTRO HEADLINE"
    },
    {
      "type": "richtext",
      "id": "default_content",
      "label": "Default content",
      "default": "<p>Add your collection summary content here.</p>"
    },
    {
      "type": "header",
      "content": "Callout Box"
    },
    {
      "type": "checkbox",
      "id": "show_callout",
      "label": "Show callout box",
      "default": true
    },
    {
      "type": "text",
      "id": "callout_text",
      "label": "Callout text",
      "default": "Trip planning is free. Price-match guaranteed."
    },
    {
      "type": "header",
      "content": "Spacing"
    },
    {
      "type": "range",
      "id": "padding_top",
      "min": 0,
      "max": 100,
      "step": 4,
      "unit": "px",
      "label": "Padding top",
      "default": 60
    },
    {
      "type": "range",
      "id": "padding_bottom",
      "min": 0,
      "max": 100,
      "step": 4,
      "unit": "px",
      "label": "Padding bottom",
      "default": 60
    }
  ],
  "presets": [
    {
      "name": "Travel Collection Summary"
    }
  ]
}
{% endschema %}
