{% include 'shogun-content-handler' %}
<!doctype html>

<html class="no-js" lang="{{ request.locale.iso_code }}">
  <head>
 {%- render 'ecom_header' -%}
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, height=device-height, minimum-scale=1.0, maximum-scale=1.0">
    <meta name="theme-color" content="{{ settings.accent_color }}">

    <title>
      {%- if template.name == 'index' -%}
        Trident Fly Fishing: Gear, Fly Rods, Reels + FREE Shipping over $49
      {%- elsif template.name == 'collection' and collection -%}
        {%- if current_page > 1 -%}
          {{ 'general.meta.page' | t: page: current_page }} of {{ collection.title }} | {{ shop.name }}
        {%- else -%}
          {{ collection.title }} | {{ shop.name }}
        {%- endif -%}
      {%- else -%}
        {%- if page_title == blank -%}
          {{ shop.name }}
        {%- else -%}
          {{ page_title }}{%- if current_page != 1 -%} &ndash; {{ 'general.meta.page' | t: page: current_page }}{%- endif -%}
        {%- endif -%}
      {%- endif -%}
    </title>

    {%- comment -%}
    Dynamic meta description + canonical:
    - Adds a custom meta description for /collections/all?page=...
    - Falls back to sensible defaults elsewhere
    - Keeps canonical correct on pagination
    {%- endcomment -%}

    {%- assign meta_desc = page_description | default: '' -%}

    {%- if template.name == 'collection' and collection -%}
      {%- assign page_num = current_page | default: 1 -%}

      {%- comment %}Check if this is a vendor-filtered collection (e.g., /collections/vendors?q=Kona){% endcomment -%}
      {%- assign vendor_query = '' -%}
      {%- if collection.handle == 'vendors' and collection.current_vendor != blank -%}
        {%- assign vendor_query = collection.current_vendor -%}
      {%- elsif request.path contains '/collections/vendors' -%}
        {%- comment %}Extract vendor from query parameter if available{% endcomment -%}
        {%- assign query_parts = request.path | split: '?q=' -%}
        {%- if query_parts.size > 1 -%}
          {%- assign vendor_query = query_parts[1] | split: '&' | first | url_decode | capitalize -%}
        {%- endif -%}
      {%- endif -%}

      {%- if vendor_query != '' -%}
        {%- comment %}Generate unique meta description for vendor pages{% endcomment -%}
        {%- if page_num > 1 -%}
          {%- assign meta_desc = 'Browse ' | append: vendor_query | append: ' fly fishing gear at ' | append: shop.name | append: ' - rods, reels, flies and more with free shipping over $49. Page ' | append: page_num -%}
        {%- else -%}
          {%- assign meta_desc = 'Shop ' | append: vendor_query | append: ' fly fishing gear at ' | append: shop.name | append: ' - premium rods, reels, flies and accessories with free shipping over $49 and expert advice.' -%}
        {%- endif -%}
      {%- elsif collection.handle == 'all' -%}
        {%- if page_num > 1 -%}
          {%- assign meta_desc = 'Browse all products at ' | append: shop.name | append: ' — Page ' | append: page_num -%}
        {%- else -%}
          {%- if meta_desc == '' -%}
            {%- assign meta_desc = 'Browse all products at ' | append: shop.name -%}
          {%- endif -%}
        {%- endif -%}
      {%- else -%}
        {%- comment %}Optional: basic fallback for other collections{% endcomment -%}
        {%- if meta_desc == '' -%}
          {%- assign meta_desc = collection.description | strip_html | strip | truncate: 300 -%}
          {%- if meta_desc == '' -%}
            {%- assign meta_desc = collection.title | append: ' – Shop ' | append: shop.name -%}
          {%- endif -%}
        {%- endif -%}
      {%- endif -%}
    {%- elsif template.name == 'blog' and blog -%}
      {%- assign page_num = current_page | default: 1 -%}

      {%- comment %}Handle tagged blog pages{% endcomment -%}
      {%- if current_tags.size > 0 -%}
        {%- assign tag_name = current_tags.first | downcase | replace: 'category_', '' | replace: '_', ' ' | replace: '-', ' ' | capitalize -%}
        {%- if page_num > 1 -%}
          {%- assign meta_desc = tag_name | append: ' reviews, articles, and guides from ' | append: shop.name | append: ' — Page ' | append: page_num -%}
        {%- else -%}
          {%- if meta_desc == '' -%}
            {%- assign meta_desc = 'Browse ' | append: tag_name | append: ' reviews, articles, and guides from ' | append: shop.name -%}
          {%- endif -%}
        {%- endif -%}
      {%- else -%}
        {%- comment %}Untagged blog pages{% endcomment -%}
        {%- if page_num > 1 -%}
          {%- assign meta_desc = 'Browse articles from ' | append: blog.title | append: ' at ' | append: shop.name | append: ' — Page ' | append: page_num -%}
        {%- else -%}
          {%- if meta_desc == '' -%}
            {%- assign meta_desc = blog.title | append: ' — Articles and guides from ' | append: shop.name -%}
          {%- endif -%}
        {%- endif -%}
      {%- endif -%}
    {%- endif -%}

    {%- comment %}Fallback for homepage and other pages without descriptions{% endcomment -%}
    {%- if meta_desc == '' and template.name == 'index' -%}
      {%- assign meta_desc = 'GET FREE SHIPPING on fly Fishing Gear from top brands like Sage, Hatch, and Orvis, plus Expert Advice and top-notch customer service. Call us at 1-888-413-5211' -%}
    {%- endif -%}

    {%- if meta_desc != '' -%}
      <meta name="description" content="{{ meta_desc | strip | escape | truncate: 320 }}">
    {%- endif -%}

    {%- comment -%}
    Canonical:
    - On paginated collection pages, be explicit about the ?page=N canonical.
    - Elsewhere, use Shopify's canonical_url.
    {%- endcomment -%}
    {%- if template.name == 'collection' and collection and current_page > 1 -%}
      <link rel="canonical" href="{{ request.origin }}{{ request.path }}?page={{ current_page }}">
    {%- else -%}
      <link rel="canonical" href="{{ canonical_url }}">
    {%- endif -%}

    {% if template.name == 'collection' and collection and collection.handle == 'quick-order' %}
      <meta name="robots" content="noindex, nofollow">
    {% endif %}

    {%- if template.name == 'collection' and collection and current_page > 1 -%}
      <link rel="prev" href="{{ request.origin }}{{ request.path }}{% if current_page > 2 %}?page={{ current_page | minus: 1 }}{% endif %}">
    {%- endif -%}
    {%- if template.name == 'collection' and collection and paginate.pages > current_page -%}
      <link rel="next" href="{{ request.origin }}{{ request.path }}?page={{ current_page | plus: 1 }}">
    {%- endif -%}



    {%- if settings.favicon -%}
      <link rel="shortcut icon" href="{{ settings.favicon | img_url: '96x96' }}" type="image/png">
    {%- endif -%}

    {%- comment -%}Few prefech to increase performance on commonly used third-parties{%- endcomment -%}
    <link rel="preload" as="style" href="{{ 'theme.css' | asset_url }}">
    <link rel="preload" as="script" href="{{ 'theme.js' | asset_url }}">
    <link rel="preconnect" href="https://cdn.shopify.com">
    <link rel="preconnect" href="https://fonts.shopifycdn.com">
    <link rel="dns-prefetch" href="https://productreviews.shopifycdn.com">
    <link rel="dns-prefetch" href="https://ajax.googleapis.com">
    <link rel="dns-prefetch" href="https://maps.googleapis.com">
    <link rel="dns-prefetch" href="https://maps.gstatic.com">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&display=swap" rel="stylesheet">


    {% render 'social-meta-tags' %}
    {% render 'css-variables' %}

    {%- comment -%}Preconnect and preload Affirm for faster loading{%- endcomment -%}
    <link rel="preconnect" href="https://cdn1.affirm.com" crossorigin>
    <link rel="dns-prefetch" href="https://cdn1.affirm.com">
    <link rel="preload" href="https://cdn1.affirm.com/js/v2/affirm.js" as="script">

    {{ content_for_header }}

    {%- comment -%}Affirm.js Direct Integration with Public API Key{%- endcomment -%}
    <script>
      _affirm_config = {
        public_api_key: "OM90KWWMZHWX228Q",
        script: "https://cdn1.affirm.com/js/v2/affirm.js",
        locale: "en_US",
        country_code: "USA"
      };
      (function(m,g,n,d,a,e,h,c){var b=m[n]||{},k=document.createElement(e),p=document.getElementsByTagName(e)[0],l=function(a,b,c){return function(){a[b]._.push([c,arguments])}};b[d]=l(b,d,"set");var f=b[d];b[a]={};b[a]._=[];f._=[];b._=[];b[a][h]=l(b,a,h);b[c]=function(){b._.push([h,arguments])};a=0;for(c="set add save post open empty reset on off trigger ready setProduct".split(" ");a<c.length;a++)f[c[a]]=l(b,d,c[a]);a=0;for(c=["get","token","url","items"];a<c.length;a++)f[c[a]]=function(){};k.async=!0;k.src=g[e];p.parentNode.insertBefore(k,p);delete g[e];f(g);m[n]=b})(window,_affirm_config,"affirm","checkout","ui","script","ready","jsReady");
    </script>

    <link rel="stylesheet" href="{{ 'theme.css' | asset_url }}">

    {% render 'microdata-schema' %}

    <script>
      // This allows to expose several variables to the global scope, to be used in scripts
      window.theme = {
        pageType: {{ request.page_type | json }},
        cartCount: {{ cart.item_count | json }},
        moneyFormat: {{ shop.money_format | json }},
        moneyWithCurrencyFormat: {{ shop.money_with_currency_format | json }},
        currencyCodeEnabled: {{ settings.currency_code_enabled | json }},
        showDiscount: {{ settings.show_discount | json }},
        discountMode: {{ settings.discount_mode | json }},
        cartType: {{ settings.cart_type | json }}
      };

      window.routes = {
        rootUrl: {{ routes.root_url | json }},
        rootUrlWithoutSlash: {% if routes.root_url == '/' %}''{% else %}{{ routes.root_url | json }}{% endif %},
        cartUrl: {{ routes.cart_url | json }},
        cartAddUrl: {{ routes.cart_add_url | json }},
        cartChangeUrl: {{ routes.cart_change_url | json }},
        searchUrl: {{ routes.search_url | json }},
        productRecommendationsUrl: {{ routes.product_recommendations_url | json }}
      };

      window.languages = {
        productRegularPrice: {{ 'product.general.regular_price' | t | json }},
        productSalePrice: {{ 'product.general.sale_price' | t | json }},
        collectionOnSaleLabel: {{ 'collection.product.discount_html' | t | json }},
        productFormUnavailable: {{ 'product.form.unavailable' | t | json }},
        productFormAddToCart: {{ 'product.form.add_to_cart' | t | json }},
        productFormPreOrder: {{ 'product.form.pre_order' | t | json }},
        productFormSoldOut: {{ 'product.form.sold_out' | t | json }},
        productAdded: {{ 'product.form.added' | t | json }},
        productAddedShort: {{ 'product.form.added_short' | t | json }},
        shippingEstimatorNoResults: {{ 'cart.shipping_estimator.no_results_title' | t | json }},
        shippingEstimatorOneResult: {{ 'cart.shipping_estimator.one_result_title' | t | json }},
        shippingEstimatorMultipleResults: {{ 'cart.shipping_estimator.multiple_results_title' | t | json }},
        shippingEstimatorErrors: {{ 'cart.shipping_estimator.errors' | t | json }}
      };

      document.documentElement.className = document.documentElement.className.replace('no-js', 'js');
    </script>

    {%- if request.page_type == 'customers/addresses' -%}
      <script src="{{ 'shopify_common.js' | shopify_asset_url }}" defer></script>
      <script src="{{ 'customer_area.js' | shopify_asset_url }}" defer></script>
    {%- endif -%}

    <script src="{{ 'theme.js' | asset_url }}" defer></script>
    <script src="{{ 'custom.js' | asset_url }}" defer></script>
    <script src="{{ 'rei-zoom-modal.js' | asset_url }}" defer></script>

    {%- if request.page_type != 'cart' -%}
      <script>
        (function () {
          window.onpageshow = function() {
            // We force re-freshing the cart content onpageshow, as most browsers will serve a cache copy when hitting the
            // back button, which cause staled data
            document.documentElement.dispatchEvent(new CustomEvent('cart:refresh', {
              bubbles: true,
              detail: {scrollToTop: false}
            }));
          };
        })();
      </script>
    {%- endif -%}
  {% include 'pagefly-app-header' %}{% include 'hulk_po_vd' %}
  {% render 'shogun-head' %}
</head>

  <body class="warehouse--v4 {% if settings.animation_image_zoom %}features--animate-zoom{% endif%} template-{{ request.page_type | handle }} {% if request.page_type contains '/' %}template-{{ request.page_type | split: '/' | last | handle }}{% endif %}" data-instant-intensity="viewport">
    {%- comment -%}Common SVG definitions that we are re-using in several places{%- endcomment -%}
    <svg class="visually-hidden">
      <linearGradient id="rating-star-gradient-half">
        <stop offset="50%" stop-color="var(--product-review-star-color)" />
        <stop offset="50%" stop-color="rgba(var(--text-color-rgb), .4)" stop-opacity="0.4" />
      </linearGradient>
    </svg>

    <a href="#main" class="visually-hidden skip-to-content">{{ 'general.accessibility.skip_to_content' | t }}</a>
    <span class="loading-bar"></span>

    {%- sections 'header-group' -%}
    {%- sections 'overlay-group' -%}

    <main id="main" role="main">
      {{ content_for_layout }}
    </main>

    {%- sections 'footer-group' -%}

    <ul hidden>
      <li id="a11y-new-window-message">{{ 'general.accessibility.new_window' | t }}</li>
    </ul>
  {%- render "ecom_footer"-%}</body>
</html>
